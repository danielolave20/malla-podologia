<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b1220" />
  <title>Malla Curricular ‚Äì Podolog√≠a Cl√≠nica</title>
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="icon" href="icons/icon-192.png">
  <style>
    :root{
      --bg-overlay: rgba(0,0,0,.30);
      --accent: #22d3ee;
      /* palette by area */
      --col-transversal-salud: #28b487;     /* verde salud */
      --col-disciplinar: #c026d3;           /* magenta */
      --col-talleres: #2ea3f2;              /* azul brillante */
      --col-proceso: #f97316;               /* naranja */
      --col-transversal: #14b8a6;           /* teal */
    }
    *{ box-sizing: border-box; }
    html, body{ margin:0; padding:0; max-width:100vw; overflow-x:hidden; background:#0b1220; color:#e5e7eb; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans"; }
    body::before{ content:""; position:fixed; inset:0; z-index:-2; background:url('assets/bg-default.png') center/cover no-repeat fixed; }
    body::after{ content:""; position:fixed; inset:0; z-index:-1; background:var(--bg-overlay); }
    header{ padding: calc(env(safe-area-inset-top) + 16px) 16px 10px; text-align:center; }
    h1{ margin:0 0 6px; font-weight:900; font-size: clamp(22px, 4vw, 36px); }
    .subtitle{ margin:0 auto 8px; color:#cbd5e1; font-size: clamp(12px, 2.2vw, 15px); }
.info-banner{
  position: sticky; top: 0; z-index: 5;
  margin: 0 auto 10px; padding: 8px 10px;
  display: flex; gap: 12px; flex-wrap: wrap; justify-content: center;
  background: rgba(15,23,42,.6); border:1px solid #334155; border-radius: 12px;
  backdrop-filter: blur(2px);
}
.info-banner span{ font-size: 13px; color:#e5e7eb; }
.area-progress{ display:flex; align-items:center; gap:8px; margin:8px 0 2px; }
.area-progress .ap-title{ font-weight:800; color:#cbd5e1; font-size:12px; flex:0 0 auto; }
.area-progress .progress{ flex:1; }
    .toolbar{ display:flex; justify-content:center; gap:8px; }
    button{ cursor:pointer; background:#fff; color:#0b1220; border:none; border-radius:14px; padding:12px 14px; font-weight:900; min-height:44px; min-width:44px; box-shadow:0 2px 8px rgba(0,0,0,.25); }
    .menu{ position:relative; }
    .menu-panel{ position:absolute; right:0; top:calc(100% + 8px); background:#0f172a; border:1px solid #334155; border-radius:14px; padding:8px; min-width:280px; display:none; box-shadow: 0 10px 24px rgba(0,0,0,.35); }
    .menu.open .menu-panel{ display:block; }
    .menu-item{ display:flex; justify-content:space-between; align-items:center; gap:8px; padding:10px 12px; border-radius:10px; color:#e5e7eb; }
    .menu-item:hover{ background:#111827; }
    .switch{ position:relative; width:54px; height:30px; background:#1f2937; border-radius:999px; border:1px solid #374151; }
    .switch input{ display:none; }
    .switch .knob{ position:absolute; top:2px; left:2px; width:26px; height:26px; border-radius:50%; background:#9ca3af; transition:all .2s; }
    .switch input:checked + .knob{ left:26px; background:#34d399; }
    main{ padding: 8px 14px calc(env(safe-area-inset-bottom) + 24px); max-width: 1400px; margin: 0 auto; }

    /* Legend always visible */
    .legend { background: rgba(15,23,42,.7); border:1px solid #334155; border-radius: 14px; padding: 10px 12px; margin-bottom: 12px; }
    .legend .legend-title{ font-weight:800; margin-bottom:6px; }
    .legend-pill{ display:inline-flex; align-items:center; gap:8px; margin-right:12px; font-size:14px; }
    .pill{ display:inline-block; width:28px; height:14px; border-radius:999px; }
    .pill.trans-salud{ background: var(--col-transversal-salud); }
    .pill.disciplinar{ background: var(--col-disciplinar); }
    .pill.talleres{ background: var(--col-talleres); }
    .pill.proceso{ background: var(--col-proceso); }
    .pill.transversal{ background: var(--col-transversal); }

    /* Grid layout by area */
    .areas{ display:grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap:14px; }
    .area{ background: rgba(15,23,42,.7); border:1px solid #334155; border-radius:16px; padding:12px; }
    .area h3{ margin:4px 0 10px; font-size:14px; letter-spacing:.06em; text-transform:uppercase; color:#cbd5e1; }
    .course{ position:relative; border-radius:12px; padding:12px; margin-bottom:10px; min-height:56px;
             display:flex; align-items:center; justify-content:center; text-align:center; font-weight:900; line-height:1.2;
             color:#0b1220; cursor:pointer; user-select:none; transition: transform .05s ease, filter .2s ease, opacity .2s ease; }
    .course.trans-salud{ background: var(--col-transversal-salud); }
    .course.disciplinar{ background: var(--col-disciplinar); color:#fff; }
    .course.talleres{ background: var(--col-talleres); color:#fff; }
    .course.proceso{ background: var(--col-proceso); color:#0b1220; }
    .course.transversal{ background: var(--col-transversal); color:#0b1220; }

    .course.blocked{ filter:grayscale(.75) brightness(.75); opacity:.7; cursor:not-allowed; }
    .course.blocked::after{ content:"Bloqueado"; position:absolute; right:8px; top:8px; background:#0b1220; color:#fff; font-size:11px; padding:2px 8px; border-radius:999px; opacity:.8; }
    .show-auth .course.blocked{ cursor:pointer; opacity:.9; filter: grayscale(.35) brightness(.95); }
    .show-auth .course.blocked::after{ content:"Autorizar"; background:#fbbf24; color:#0b1220; opacity:1; }
    .course.authorized::after{ content:"Autorizado"; position:absolute; right:8px; top:8px; background:#fde68a; color:#92400e; font-size:11px; padding:2px 8px; border-radius:999px; }
    .course.approved{ outline:3px solid var(--accent); outline-offset:2px; box-shadow:0 0 0 2px rgba(255,255,255,.18) inset, 0 6px 14px rgba(0,0,0,.25); opacity:.9; }
    .course.approved .t{ text-decoration: line-through; text-decoration-thickness:3px; text-underline-offset:5px; opacity:.75; }
    .course.approved::before{ content:"‚úì Aprobado"; position:absolute; left:10px; top:8px; background:#34d399; color:#0b1220; font-size:11px; font-weight:900; padding:2px 8px; border-radius:999px; }

    /* Metrics */
    .metrics{ display:grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap:10px; margin:12px 0; }
    .metric-card{ background: rgba(15,23,42,.7); border:1px solid #334155; border-radius: 16px; padding:12px; }
    .metric-title{ font-weight:800; color:#cbd5e1; margin-bottom:8px; }
    .big{ font-size:28px; font-weight:900; }
    .progress{ width:100%; height:12px; background:#0b1220; border-radius:999px; border:1px solid #334155; overflow:hidden; }
    .bar{ height:100%; width:0%; background: linear-gradient(90deg, #22d3ee, #60a5fa); }

    /* Responsive */
    @media (max-width: 820px){
      header{ padding: calc(env(safe-area-inset-top) + 12px) 10px 6px; }
      h1{ font-size: clamp(20px, 6vw, 28px); }
      .areas{ grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
      .course{ min-height:54px; padding:10px; }
    }
    @media (max-width: 600px){ .areas{ grid-template-columns: 1fr; } }

    /* Modal Felicitaciones (celebration) */
    .modal{ position: fixed; inset:0; background: rgba(0,0,0,.7); display:none; align-items:center; justify-content:center; z-index: 50; }
    .modal.open { display:flex; }
    .modal-card{
      background: radial-gradient(1200px 600px at 50% -20%, rgba(99,102,241,.25), transparent 40%),
                  linear-gradient(180deg, #0f172a 0%, #0b1220 100%);
      color:#eaf2ff; border:1px solid #364152; padding:22px; border-radius:22px; width:min(640px, 92vw);
      text-align:center; position: relative; box-shadow: 0 20px 60px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.06);
      animation: celebrateIn .35s ease-out;
    }
    .cele-title{ font-size: clamp(22px, 3.2vw, 34px); font-weight:900; margin:6px 0 10px;
      background: linear-gradient(90deg, #fcd34d, #f59e0b, #fda4af); -webkit-background-clip:text; background-clip:text; color:transparent; }
    .cele-sub{ font-size: clamp(15px, 1.9vw, 18px); line-height:1.6; color:#dbeafe; margin:6px 0 4px; }
    .cele-hr{ height:1px; background: linear-gradient(90deg, transparent, #334155, transparent); margin:12px 0; }
    .cele-emoji{ font-size: 38px; display:inline-block; animation: bob 2s ease-in-out infinite; }
    .cele-actions{ display:flex; justify-content:center; gap:12px; margin-top:14px; }
    .btnx{ cursor:pointer; border:none; padding:12px 18px; min-width:120px; min-height:44px; border-radius:16px; font-weight:900; font-size:16px;
      box-shadow: 0 6px 16px rgba(0,0,0,.3); transition: transform .05s ease, filter .2s ease, box-shadow .2s ease; color:#0b1220; background:#fff; }
    .btnx.primary{ background:#34d399; } .btnx.secondary{ background:#93c5fd; }
    .btnx:active{ transform: translateY(1px); filter: brightness(.98); }
    @keyframes celebrateIn{ from{ transform: translateY(6px) scale(.98); opacity:0 } to{ transform:none; opacity:1 } }
    @keyframes bob{ 0%,100%{ transform: translateY(0) } 50%{ transform: translateY(-6px) } }
    .footer{ padding:18px; text-align:center; color:#cbd5e1; font-size:12px; }
  </style>
</head>
<body>
  <canvas id="confetti" class="confetti-canvas" aria-hidden="true" style="position:fixed; inset:0; pointer-events:none; z-index:49;"></canvas>
  <header>
    <h1>Malla Curricular ‚Äì Podolog√≠a Cl√≠nica</h1>
    <p class="subtitle">Optimizada para tablet/Android ¬∑ Instalaci√≥n como app ¬∑ Offline</p>
<div class="info-banner" role="note" aria-label="Informaci√≥n de la carrera">
  <span>üìö <strong>Plan de estudio:</strong> Plan Regular</span>
  <span>üñ•Ô∏è <strong>Modalidad:</strong> Semi-Presencial</span>
  <span>‚è≥ <strong>Duraci√≥n:</strong> 18 meses</span>
</div>
    <div class="toolbar">
      <div class="menu" id="menu">
        <button id="menuBtn" aria-haspopup="true" aria-expanded="false" aria-controls="menuPanel">Men√∫ ‚ñæ</button>
        <div id="menuPanel" class="menu-panel" role="menu" aria-labelledby="menuBtn">
          <div class="menu-item">
            <span>Modo autorizaci√≥n</span>
            <label class="switch"><input id="authMode" type="checkbox" /><span class="knob"></span></label>
          </div>
          <div class="menu-item" id="resetBtn"><span>Reiniciar todo</span><span class="btn" style="padding:6px 10px;">‚ü≤</span></div>
        </div>
      </div>
    </div>
  </header>
  <main>
    <div class="legend">
      <div class="legend-title">Leyenda de colores</div>
      <p class="legend-body">
        <span class="legend-pill"><span class="pill trans-salud"></span> Formaci√≥n transversal salud</span>
        <span class="legend-pill"><span class="pill disciplinar"></span> Formaci√≥n disciplinar</span>
        <span class="legend-pill"><span class="pill talleres"></span> Talleres pr√°cticos</span>
        <span class="legend-pill"><span class="pill proceso"></span> Proceso de titulaci√≥n</span>
        <span class="legend-pill"><span class="pill transversal"></span> Formaci√≥n transversal</span>
      </p>
    </div>

    <section class="metrics" aria-live="polite">
      <div class="metric-card">
        <div class="metric-title">Progreso global</div>
        <div class="progress"><div id="barGlobal" class="bar"></div></div>
        <div class="big" id="pctGlobal">0%</div>
      </div>
    </section>

    <div id="areas" class="areas"></div>
  </main>

  <div id="modalCongrats" class="modal" role="dialog" aria-modal="true" aria-labelledby="congratsTitle">
    <div class="modal-card">
      <div class="cele-emoji" aria-hidden="true">üéì‚ú®</div>
      <h2 id="congratsTitle" class="cele-title">¬°Meta Alcanzada!</h2>
      <div class="cele-hr"></div>
      <p class="cele-sub">Has completado <strong>toda tu malla de Podolog√≠a Cl√≠nica</strong>. Est√°s a un paso de tu <strong>proceso de titulaci√≥n</strong>.</p>
      <p class="cele-sub"><strong>¬°Tu esfuerzo y constancia hoy brillan m√°s que nunca!</strong></p>
      <div class="cele-actions">
        <button id="closeCongrats" class="btnx primary">¬°Gracias! üéâ</button>
        <button id="resetFromCongrats" class="btnx secondary">Reiniciar</button>
      </div>
    </div>
  </div>

  <footer class="footer">App creada por Daniel Olave Valle ¬∑ Agosto 2025</footer>

  <script>
  // -------- Datos por √°rea (seg√∫n imagen) --------
  const areas = [
    { name: 'Formaci√≥n transversal salud', key:'trans-salud', courses: [
      'Biolog√≠a y Microbiolog√≠a',
      'Anatomomorfolog√≠a y Patolog√≠as',
      'Primeros Auxilios y Prevenci√≥n de Riesgos',
      'IAAS y Esterilizaci√≥n',
      'Salud Mental'
    ]},
    { name: 'Formaci√≥n disciplinar', key:'disciplinar', courses: [
      'Anatom√≠a del Pie',
      'Introducci√≥n al Rol',
      'Patolog√≠as Cr√≥nicas Podol√≥gicas',
      'Dermatolog√≠a y Trastornos Ungueales',
      'Podolog√≠a en el Paciente Diab√©tico'
    ]},
    { name: 'Talleres pr√°cticos', key:'talleres', courses: [
      'Farmacolog√≠a Podol√≥gica',
      'Biomec√°nica y Ortopedia',
      'Podolog√≠a en el Ni√±o y Adolescente',
      'Podolog√≠a Deportiva',
      'Taller de Atenci√≥n Geri√°trica'
    ]},
    { name: 'Gesti√≥n y procedimientos', key:'talleres', courses: [
      'Administraci√≥n de Gabinete Podol√≥gico',
      'Masoterapia y Reflexolog√≠a',
      'Taller de Procedimientos B√°sicos',
      'Taller de Procedimientos Avanzada'
    ]},
    { name: 'Proceso de titulaci√≥n', key:'proceso', courses: [
      'Pr√°ctica Laboral', 'Informe de Pr√°ctica', 'Examen de T√≠tulo'
    ]},
    { name: 'Formaci√≥n transversal', key:'transversal', courses: [
      'Redacci√≥n de Informes T√©cnicos', 'Responsabilidad Social'
    ]},
  ];

  // -------- Estado --------
  const STATE_KEY = 'pc_malla_state_v1.0.0';
  const defaultState = { approvals: {}, auth: {} };
  let state = loadState();

  function loadState(){ try{ const raw=localStorage.getItem(STATE_KEY); if(raw){ return { ...defaultState, ...JSON.parse(raw) }; } }catch(e){} return structuredClone(defaultState); }
  function saveState(){ localStorage.setItem(STATE_KEY, JSON.stringify(state)); }

  function slug(str){ return str.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,''); }
  function courseId(areaKey, title){ return slug(areaKey+'-'+title); }

  // -------- Render --------
  function render(){
    const wrap = document.getElementById('areas'); wrap.innerHTML = '';

    for(const a of areas){
      const col = document.createElement('div'); col.className='area';
      const h = document.createElement('h3'); h.textContent = a.name; col.appendChild(h);
      const ap = document.createElement('div'); ap.className='area-progress';
      ap.innerHTML = `<span class="ap-title">Progreso</span><div class="progress"><div class="bar" id="bar-${a.key}"></div></div><div class="big" style="font-size:14px" id="pct-${a.key}">0%</div>`;
      col.appendChild(ap);

      for(const title of a.courses){
        const id = courseId(a.key, title);
        const approved = !!state.approvals[id];
        const authorized = !!state.auth[id];

        // No prerrequisitos espec√≠ficos provistos -> solo bloqueo por orden: desbloquearemos lineal por columna
        let blocked = false;
        const index = a.courses.indexOf(title);
        if(index>0){
          const prevId = courseId(a.key, a.courses[index-1]);
          if(!state.approvals[prevId]) blocked = true;
        }
        if(authorized) blocked=false;

        const div = document.createElement('div');
        div.className = `course ${a.key} ${approved?'approved':''} ${blocked?'blocked':''} ${authorized?'authorized':''}`;
        div.setAttribute('role','button'); div.setAttribute('tabindex','0'); div.setAttribute('aria-pressed', approved?'true':'false');
        div.innerHTML = `<span class="t">${title}</span>`;

        function toggle(){
          const authEnabled = document.getElementById('authMode').checked;
          if(blocked){
            if(authEnabled){ state.auth[id] = !authorized; saveState(); render(); }
            return;
          }
          state.approvals[id] = !approved; saveState(); render(); checkCompletion();
        }
        div.addEventListener('click', toggle);
        div.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); toggle(); }});

        col.appendChild(div);
      }
      wrap.appendChild(col);
    }
    updateProgress();
  }

  function updateProgress(){
    // global
    const all = areas.flatMap(a => a.courses.map(t => courseId(a.key, t)));
    const done = all.filter(id => !!state.approvals[id]).length;
    const pct = Math.round(done / all.length * 100);
    document.getElementById('barGlobal').style.width = pct+'%';
    document.getElementById('pctGlobal').textContent = pct+'%';
    // per area
    for(const a of areas){
      const list = a.courses.map(t => courseId(a.key, t));
      const doneA = list.filter(id => !!state.approvals[id]).length;
      const pctA = Math.round(doneA / list.length * 100);
      const bar = document.getElementById('bar-'+a.key);
      const pctEl = document.getElementById('pct-'+a.key);
      if(bar){ bar.style.width = pctA+'%'; }
      if(pctEl){ pctEl.textContent = pctA+'%'; }
    }
  }

  function checkCompletion(){
    const all = areas.flatMap(a => a.courses.map(t => courseId(a.key, t)));
    const done = all.every(id => !!state.approvals[id]);
    const modal = document.getElementById('modalCongrats');
    if(done){ modal.classList.add('open'); runConfetti(); }
    else { modal.classList.remove('open'); stopConfetti(); }
  }

  let confettiAnim=null;
  function runConfetti(){
    const canvas = document.getElementById('confetti');
    const ctx = canvas.getContext('2d');
    let w = canvas.width = window.innerWidth;
    let h = canvas.height = window.innerHeight;
    const pieces = Array.from({length: 220}, () => ({
      x: Math.random()*w, y: Math.random()*-h, size: 6+Math.random()*8, speed: 1+Math.random()*3, angle: Math.random()*Math.PI*2,
    }));
    function onResize(){ w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; }
    window.addEventListener('resize', onResize);
    function draw(){
      ctx.clearRect(0,0,w,h);
      for(const p of pieces){
        p.y += p.speed; p.angle += 0.05;
        const s = p.size * (0.6 + 0.4*Math.sin(p.angle));
        ctx.fillStyle = ['#22d3ee','#60a5fa','#f59e0b','#10b981','#a78bfa','#f472b6'][Math.floor(Math.random()*6)];
        ctx.fillRect(p.x, p.y, s, s*0.6);
        if(p.y > h+20){ p.y = -20; p.x = Math.random()*w; }
      }
      confettiAnim = requestAnimationFrame(draw);
    }
    draw();
  }
  function stopConfetti(){ if(confettiAnim){ cancelAnimationFrame(confettiAnim); confettiAnim = null; } }

  
  // Felicitaciones modal handlers
  function setupCongrats(){
    const modal = document.getElementById('modalCongrats');
    const btnClose = document.getElementById('closeCongrats');
    const btnReset = document.getElementById('resetFromCongrats');

    function closeModal(){
      modal.classList.remove('open');
      stopConfetti();
    }
    if(btnClose) btnClose.addEventListener('click', closeModal);
    if(btnReset) btnReset.addEventListener('click', ()=>{
      localStorage.removeItem(STATE_KEY);
      state = { approvals:{}, auth:{} };
      render(); updateProgress(); closeModal();
    });
    // Cerrar al hacer click en el fondo (no en la tarjeta)
    modal.addEventListener('click', (e)=>{
      if(e.target === modal){ closeModal(); }
    });
    // Cerrar con ESC
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape' && modal.classList.contains('open')) closeModal();
    });
  }

  // Menu & SW
  function setupMenu(){
    const menu = document.getElementById('menu');
    const btn = document.getElementById('menuBtn');
    btn.addEventListener('click', (e)=>{ e.stopPropagation(); const open = menu.classList.toggle('open'); btn.setAttribute('aria-expanded', open?'true':'false'); });
    document.addEventListener('click', (e)=>{ if(!menu.contains(e.target)){ menu.classList.remove('open'); btn.setAttribute('aria-expanded','false'); }});
    document.getElementById('resetBtn').addEventListener('click', ()=>{
      if(confirm('¬øSeguro que deseas reiniciar todo?')){ localStorage.removeItem(STATE_KEY); state = structuredClone({ approvals:{}, auth:{} }); render(); checkCompletion(); }
    });
  }
  if('serviceWorker' in navigator){ window.addEventListener('load', ()=> navigator.serviceWorker.register('./sw.js').catch(()=>{}) ); }

  render(); setupMenu(); setupCongrats(); checkCompletion();
  </script>
</body>
</html>
